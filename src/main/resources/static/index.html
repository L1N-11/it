<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>20234069杨宗霖IT岗位求职记录系统</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background-color: #f8f9fa;
        }
        .container {
            max-width: 1200px;
        }
        .card {
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .form-control:focus {
            border-color: #4CAF50;
            box-shadow: 0 0 0 0.25rem rgba(76, 175, 80, 0.25);
        }
        .btn-success {
            background-color: #4CAF50;
            border-color: #4CAF50;
        }
        .btn-success:hover {
            background-color: #45a049;
            border-color: #45a049;
        }
        .status-badge {
            font-size: 0.875rem;
            padding: 0.35em 0.65em;
        }
        .badge-primary {
            background-color: #0d6efd;
        }
        .badge-secondary {
            background-color: #6c757d;
        }
        .badge-success {
            background-color: #198754;
        }
        .badge-danger {
            background-color: #dc3545;
        }
        .badge-warning {
            background-color: #ffc107;
            color: #000;
        }
    </style>
</head>
<body>
    <header class="bg-primary text-white py-4">
        <div class="container">
            <h1 class="text-center">20234069杨宗霖IT岗位求职记录系统</h1>
        </div>
    </header>

    <div class="container mt-5">
        <!-- 搜索和筛选区域 -->
        <div class="card mb-4">
            <div class="card-body">
                <h2 class="h4 mb-3">搜索和筛选</h2>
                <form id="searchForm" class="row g-3">
                    <div class="col-md-4">
                        <input type="text" id="companyNameSearch" class="form-control" placeholder="企业名称">
                    </div>
                    <div class="col-md-4">
                        <input type="text" id="jobTitleSearch" class="form-control" placeholder="岗位名称">
                    </div>
                    <div class="col-md-3">
                        <select id="statusFilter" class="form-select">
                            <option value="">所有状态</option>
                            <option value="待处理">待处理</option>
                            <option value="已投递">已投递</option>
                            <option value="面试中">面试中</option>
                            <option value="已录用">已录用</option>
                            <option value="已拒绝">已拒绝</option>
                        </select>
                    </div>
                    <div class="col-md-1">
                        <button type="submit" class="btn btn-primary w-100">搜索</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- 添加新岗位按钮 -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="h4">岗位列表</h2>
            <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addJobModal">
                <i class="bi bi-plus-circle"></i> 添加岗位
            </button>
        </div>

        <!-- 岗位列表 -->
        <div id="jobList" class="row">
            <!-- 岗位卡片将在这里动态生成 -->
        </div>

        <!-- 无数据提示 -->
        <div id="noData" class="text-center py-10 d-none">
            <p class="text-muted">暂无岗位数据，请添加新岗位</p>
        </div>
    </div>

    <!-- 添加岗位模态框 -->
    <div class="modal fade" id="addJobModal" tabindex="-1" aria-labelledby="addJobModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addJobModalLabel">添加新岗位</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addJobForm" class="row g-3">
                        <div class="col-md-6">
                            <label for="companyName" class="form-label">企业名称 *</label>
                            <input type="text" id="companyName" class="form-control" required>
                        </div>
                        <div class="col-md-6">
                            <label for="jobTitle" class="form-label">岗位名称 *</label>
                            <input type="text" id="jobTitle" class="form-control" required>
                        </div>
                        <div class="col-md-4">
                            <label for="salary" class="form-label">薪资</label>
                            <input type="text" id="salary" class="form-control">
                        </div>
                        <div class="col-md-4">
                            <label for="location" class="form-label">工作地点</label>
                            <input type="text" id="location" class="form-control">
                        </div>
                        <div class="col-md-4">
                            <label for="status" class="form-label">状态</label>
                            <select id="status" class="form-select">
                                <option value="待处理">待处理</option>
                                <option value="已投递">已投递</option>
                                <option value="面试中">面试中</option>
                                <option value="已录用">已录用</option>
                                <option value="已拒绝">已拒绝</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="applicationDate" class="form-label">申请日期</label>
                            <input type="date" id="applicationDate" class="form-control">
                        </div>
                        <div class="col-md-12">
                            <label for="requirements" class="form-label">具体要求</label>
                            <textarea id="requirements" class="form-control" rows="3"></textarea>
                        </div>
                        <div class="col-md-12">
                            <label for="description" class="form-label">岗位描述</label>
                            <textarea id="description" class="form-control" rows="3"></textarea>
                        </div>
                        <div class="col-md-12">
                            <label for="notes" class="form-label">备注信息</label>
                            <textarea id="notes" class="form-control" rows="2"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-success" onclick="saveJob()">保存</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 编辑岗位模态框 -->
    <div class="modal fade" id="editJobModal" tabindex="-1" aria-labelledby="editJobModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editJobModalLabel">编辑岗位信息</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editJobForm" class="row g-3">
                        <input type="hidden" id="editJobId">
                        <div class="col-md-6">
                            <label for="editCompanyName" class="form-label">企业名称 *</label>
                            <input type="text" id="editCompanyName" class="form-control" required>
                        </div>
                        <div class="col-md-6">
                            <label for="editJobTitle" class="form-label">岗位名称 *</label>
                            <input type="text" id="editJobTitle" class="form-control" required>
                        </div>
                        <div class="col-md-4">
                            <label for="editSalary" class="form-label">薪资</label>
                            <input type="text" id="editSalary" class="form-control">
                        </div>
                        <div class="col-md-4">
                            <label for="editLocation" class="form-label">工作地点</label>
                            <input type="text" id="editLocation" class="form-control">
                        </div>
                        <div class="col-md-4">
                            <label for="editStatus" class="form-label">状态</label>
                            <select id="editStatus" class="form-select">
                                <option value="待处理">待处理</option>
                                <option value="已投递">已投递</option>
                                <option value="面试中">面试中</option>
                                <option value="已录用">已录用</option>
                                <option value="已拒绝">已拒绝</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="editApplicationDate" class="form-label">申请日期</label>
                            <input type="date" id="editApplicationDate" class="form-control">
                        </div>
                        <div class="col-md-12">
                            <label for="editRequirements" class="form-label">具体要求</label>
                            <textarea id="editRequirements" class="form-control" rows="3"></textarea>
                        </div>
                        <div class="col-md-12">
                            <label for="editDescription" class="form-label">岗位描述</label>
                            <textarea id="editDescription" class="form-control" rows="3"></textarea>
                        </div>
                        <div class="col-md-12">
                            <label for="editNotes" class="form-label">备注信息</label>
                            <textarea id="editNotes" class="form-control" rows="2"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" onclick="updateJob()">更新</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 删除确认模态框 -->
    <div class="modal fade" id="deleteJobModal" tabindex="-1" aria-labelledby="deleteJobModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteJobModalLabel">确认删除</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>确定要删除这个岗位记录吗？此操作不可撤销。</p>
                    <input type="hidden" id="deleteJobId">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-danger" onclick="confirmDeleteJob()">删除</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 获取岗位列表
        function loadJobs(searchParams = {}) {
            // 根据是否有搜索参数决定调用哪个接口
            const hasSearchParams = searchParams.companyName || searchParams.jobTitle || searchParams.status;
            let url = hasSearchParams ? 'api/jobs/search' : 'api/jobs';
            
            // 构建查询参数
            const params = new URLSearchParams();
            if (searchParams.companyName) params.append('companyName', searchParams.companyName);
            if (searchParams.jobTitle) params.append('jobTitle', searchParams.jobTitle);
            if (searchParams.status) params.append('status', searchParams.status);
            
            const queryString = params.toString();
            if (queryString) {
                url += '?' + queryString;
            }
            
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    const jobList = document.getElementById('jobList');
                    const noData = document.getElementById('noData');
                    
                    jobList.innerHTML = '';
                    
                    if (data.length === 0) {
                        noData.classList.remove('d-none');
                    } else {
                        noData.classList.add('d-none');
                        
                        data.forEach(job => {
                            const statusClass = getStatusClass(job.status);
                            const jobCard = document.createElement('div');
                            jobCard.className = 'col-md-6 col-lg-4';
                            jobCard.innerHTML = `
                                <div class="card h-100">
                                    <div class="card-header d-flex justify-content-between align-items-center bg-white border-bottom">
                                        <span class="badge ${statusClass}">${job.status || '待处理'}</span>
                                        <div>
                                            <button class="btn btn-outline-primary btn-sm me-1" onclick="editJob(${job.id})"><i class="bi bi-pencil"></i></button>
                                            <button class="btn btn-outline-danger btn-sm" onclick="deleteJob(${job.id})"><i class="bi bi-trash"></i></button>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <h3 class="h5 card-title mb-1">${job.jobTitle}</h3>
                                        <p class="text-primary mb-2">${job.companyName}</p>
                                        <div class="d-flex align-items-center text-muted mb-2">
                                            <i class="bi bi-cash me-2"></i>${job.salary || '薪资面议'}
                                        </div>
                                        <div class="d-flex align-items-center text-muted mb-3">
                                            <i class="bi bi-geo-alt me-2"></i>${job.location || '未指定'}
                                        </div>
                                        <div class="mb-3">
                                            <h4 class="h6 mb-1">岗位要求：</h4>
                                            <p class="text-sm text-muted line-clamp-3">${job.requirements || '暂无要求信息'}</p>
                                        </div>
                                        ${job.applicationDate ? `<p class="text-xs text-muted mt-2">申请日期：${formatDate(job.applicationDate)}</p>` : ''}
                                        ${job.notes ? `<p class="text-xs text-muted mt-1">备注：${job.notes}</p>` : ''}
                                    </div>
                                </div>
                            `;
                            jobList.appendChild(jobCard);
                        });
                    }
                })
                .catch(error => {
                    console.error('加载岗位列表失败:', error);
                    alert('加载岗位列表失败，请刷新页面重试');
                });
        }

        // 保存新岗位
        function saveJob() {
            const formData = {
                companyName: document.getElementById('companyName').value,
                jobTitle: document.getElementById('jobTitle').value,
                salary: document.getElementById('salary').value,
                location: document.getElementById('location').value,
                status: document.getElementById('status').value,
                applicationDate: document.getElementById('applicationDate').value || null,
                requirements: document.getElementById('requirements').value,
                description: document.getElementById('description').value,
                notes: document.getElementById('notes').value
            };

            fetch('api/jobs', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(() => {
                // 重置表单
                document.getElementById('addJobForm').reset();
                // 关闭模态框
                const modal = bootstrap.Modal.getInstance(document.getElementById('addJobModal'));
                modal.hide();
                // 重新加载岗位列表
                loadJobs();
                alert('岗位添加成功！');
            })
            .catch(error => {
                console.error('添加岗位失败:', error);
                alert('添加岗位失败，请重试');
            });
        }

        // 编辑岗位
        function editJob(id) {
            fetch(`api/jobs/${id}`)
                .then(response => response.json())
                .then(job => {
                    document.getElementById('editJobId').value = job.id;
                    document.getElementById('editCompanyName').value = job.companyName;
                    document.getElementById('editJobTitle').value = job.jobTitle;
                    document.getElementById('editSalary').value = job.salary;
                    document.getElementById('editLocation').value = job.location;
                    document.getElementById('editStatus').value = job.status || '待处理';
                    document.getElementById('editApplicationDate').value = job.applicationDate?.split('T')[0] || '';
                    document.getElementById('editRequirements').value = job.requirements;
                    document.getElementById('editDescription').value = job.description;
                    document.getElementById('editNotes').value = job.notes;
                    
                    // 显示编辑模态框
                    const editModal = new bootstrap.Modal(document.getElementById('editJobModal'));
                    editModal.show();
                })
                .catch(error => {
                    console.error('获取岗位详情失败:', error);
                    alert('获取岗位详情失败，请重试');
                });
        }

        // 更新岗位
        function updateJob() {
            const id = document.getElementById('editJobId').value;
            const formData = {
                companyName: document.getElementById('editCompanyName').value,
                jobTitle: document.getElementById('editJobTitle').value,
                salary: document.getElementById('editSalary').value,
                location: document.getElementById('editLocation').value,
                status: document.getElementById('editStatus').value,
                applicationDate: document.getElementById('editApplicationDate').value || null,
                requirements: document.getElementById('editRequirements').value,
                description: document.getElementById('editDescription').value,
                notes: document.getElementById('editNotes').value
            };

            fetch(`api/jobs/${id}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(() => {
                // 关闭模态框
                const modal = bootstrap.Modal.getInstance(document.getElementById('editJobModal'));
                modal.hide();
                // 重新加载岗位列表
                loadJobs();
                alert('岗位更新成功！');
            })
            .catch(error => {
                console.error('更新岗位失败:', error);
                alert('更新岗位失败，请重试');
            });
        }

        // 删除岗位
        function deleteJob(id) {
            document.getElementById('deleteJobId').value = id;
            const deleteModal = new bootstrap.Modal(document.getElementById('deleteJobModal'));
            deleteModal.show();
        }

        // 确认删除岗位
        function confirmDeleteJob() {
            const id = document.getElementById('deleteJobId').value;
            
            fetch(`api/jobs/${id}`, {
                method: 'DELETE'
            })
            .then(() => {
                // 关闭模态框
                const modal = bootstrap.Modal.getInstance(document.getElementById('deleteJobModal'));
                modal.hide();
                // 重新加载岗位列表
                loadJobs();
                alert('岗位删除成功！');
            })
            .catch(error => {
                console.error('删除岗位失败:', error);
                alert('删除岗位失败，请重试');
            });
        }

        // 搜索表单提交
        document.getElementById('searchForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const searchParams = {
                companyName: document.getElementById('companyNameSearch').value,
                jobTitle: document.getElementById('jobTitleSearch').value,
                status: document.getElementById('statusFilter').value
            };
            loadJobs(searchParams);
        });

        // 根据状态获取样式类
        function getStatusClass(status) {
            switch (status) {
                case '已投递': return 'status-badge badge-primary';
                case '面试中': return 'status-badge badge-warning';
                case '已录用': return 'status-badge badge-success';
                case '已拒绝': return 'status-badge badge-danger';
                default: return 'status-badge badge-secondary';
            }
        }

        // 格式化日期
        function formatDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            return date.toLocaleDateString('zh-CN');
        }

        // 初始化页面时加载岗位列表
        document.addEventListener('DOMContentLoaded', function() {
            loadJobs();
        });
    </script>
</body>
</html>